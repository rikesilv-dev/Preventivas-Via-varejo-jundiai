<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Controle de Manuten√ß√£o</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f49c;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    header {
      background:url("https://media.licdn.com/dms/image/v2/D4D3DAQG21eNJpdZ0fQ/image-scale_191_1128/image-scale_191_1128/0/1732309685171/still_brasil_empilhadeira_cover?e=2147483647&v=beta&t=lLD15uNZ1WRKFjW-X3OE3VjEGt0EwBl6topHrsMkxDU") no-repeat center center;
      color: white;
      text-align: center;
      padding: 30px 120px;
    }
    header h1 { margin: 0; }
    main {
      flex: 1;
      padding: 3px;
      max-width: 1288px;
      margin: auto;
      background: white;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    h2, h5 { text-align: center; }
    .top-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 10px;
    }
    .reset-btn, .export-btn {
      padding: 6px 10px;
      background: #34db34;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 12px;
    }
    .reset-btn { background: #e67e22; }
    .reset-btn:hover { background: #d35400; }
    .export-btn:hover { background: #2980b9; }
    .percentual { font-weight: bold; font-size: 1.1em; color: #2c3e50; }
    .nav-buttons {
        text-align: center;
        margin-bottom: 5px;
        flex-wrap: wrap;
        display: flex;
        justify-content: center;
        gap: 5px;
    }
    .nav-buttons button {
        padding: 8px 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        background: #f0f0f0;
        cursor: pointer;
    }
    .nav-buttons button.active {
        background: #2c3e50;
        color: white;
        border-color: #06101a79;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 25px;
      table-layout: auto; /* manter comportamento natural */
    }
    th, td {
      padding: 10px;
      border: 1px solid #ddd;
      text-align: center;
      vertical-align: middle;
    }
    th { background: #1b232b; color: white; }
    button.acao {
      color: white;
      border: none;
      padding: 5px 14px;
      cursor: pointer;
      border-radius: 1px;
      font-weight: bold;
      width: 100px;
    }
    button.acao.concluido { background: #2ecc71; }
    button.acao.a-realizar { background: #cf1602; }

    /* ajustes de largura dos inputs */
    input.horimetro, input.dataManut, input.oleo {
      width: 100px;
      padding: 3px;
      text-align: center;
    }

    /* N¬∫ O.S.: maior, fonte monoespa√ßada e auto-resize via JS */
    input.osNum {
      min-width: 180px;    /* m√≠nimo */
      max-width: 300px;    /* limite para n√£o destruir layout */
      padding: 6px;
      text-align: center;
      font-family: "Courier New", Courier, monospace;
      font-size: 13px;
      box-sizing: content-box; /* para facilitar ajuste por JS */
    }

    /* aumentar a largura da coluna (sugest√£o, pode ajustar) */
    th:nth-child(3), td:nth-child(3) { width: 100px; }

    .pesquisa { margin: 10px 0; text-align: center; }
    .pesquisa input {
      width: 70%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    /* ALERTA DE √ìLEO */
    .alerta { background-color: #e74c3c !important; color: white !important; font-weight: bold; }

    /* ALERTA DE ATRASO */
    .atrasado { background-color: yellow !important; font-weight: bold; }
  </style>
</head>
<body>
  <header>
    <h1>Controle de Manuten√ß√£o Mensal</h1>
  </header>

  <main>
    <div class="top-actions">
      <button class="reset-btn" onclick="novaCompetencia()">‚û§ NOVO M√äS</button>
      <button class="export-btn" onclick="exportarExcel()">‚¨á Exportar Excel</button>
      <div class="percentual" id="percentual">Preventivas conclu√≠das: 0%</div>
    </div>

    <div class="pesquisa">
      <input type="text" id="pesquisa" placeholder="üîç Pesquisar por M√°quina..." onkeyup="filtrarTabela()">
    </div>

    <div class="nav-buttons" id="nav-buttons"></div>
    <h2 id="titulo-secao"></h2>
    <h5>Desenvolvido Por Henrique Silva</h5>
    <h6> Email: Henrique.silva@kiongroup.com </h6>
    <table>
      <thead>
        <tr>
          <th>SERIE / MODELO</th>
          <th>Hor√≠metro</th>
          <th>N¬∫ O.S.</th>
          <th>A√ß√£o</th>
          <th>Data</th>
          <th>Troca de √ìleo 01</th>
          <th>Troca de √ìleo 02</th>
          <th>
            Data Anterior <br>
            <button class="reset-btn" onclick="limparDataAnteriorAtrasados()"> üóë Limpar Atrasados</button>
          </th>
          <th>
            Dias Faltantes <br>
            <button class="reset-btn" onclick="limparDiasFaltantesAtrasados()"> üóë Limpar Atrasados</button>
          </th>
        </tr>
      </thead>
      <tbody id="tabela-maquinas"></tbody>
    </table>
  </main>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <script>
     const todasAsMaquinas = [
      //MAQUINAS HENRIQUE
     "341930Y04383 FMX20 G1200 11600","341930Y04388	FMX20 G1200 11600","341930Y04390	FMX20 G1200 11600","341930Y04392	FMX20 G1200 11600",
     "341930Y04394	FMX20 G1200 11600","341930Y04445	FMX20 G1800 9800","341930Y04470	FMX20 G1200 11600","341930Y04480	FMX20 G1600 11600",
"340139Y02015	ERX27 Mec","340139Y02017	ERX27 Mec","340139Y02022	ERX27 Mec",
"340139Y02129	ERX27 Mec BLACK","340139Y02156	ERX27 Mec","340139Y02158	ERX27 Mec",
"340139Y02165	ERX27 Mec","340139Y02185	ERX27 Mec BLACK","340139Y02192	ERX27 Mec DAT",
"340139Y02205	ERX27 Mec 2400mm","341033E01151	KMSX-27 BLACK","341033E01096	KMSX-27 BLACK",
"348044Y01131	RC44-25 LEIL√ÉO","348044Y01132	RC44-25 DOC2","348044Y01130	RC44-25 DOC2",
"340129E03260	EGU","PARA ATRIBUIR","PARA ATRIBUIR",
      // MAQUINAS JUNIOR
     "341930Y04218	FMX20 G1600 9800","341930Y04252	FMX20 G1600 9800","341930Y04266	FMX20 G1600 9800 BLACK","341930Y04267	FMX20 G1600 9800",
"341930Y04269	FMX20 G1600 9800 BLACK",
"341930Y04375	FMX20 G1800 11600","341930Y04386	FMX20 G1200 11600","341930Y04387	FMX20 G1200 11600","341930Y04389	FMX20 G1200 11600",
"341930Y04401	FMX20 G1200 11600","341930Y04431	FMX20 G1800 9800","340139Y01996	ERX27 - Dire√ß√£o Mec",
"340139Y01968	ERX27 Mec","340139Y01969	ERX27 Mec","340139Y01991	ERX27 Mec","340139Y02046	ERX27 Mec","340139Y02060	ERX27 Mec",
"340139Y02070	ERX27 Mec","340139Y02113	ERX27 Mec","340139Y02115	ERX27 Mec","340139Y02133	ERX27 Mec 1800mm",
"340139Y02160	ERX27 Mec BLACK","340139Y02191	ERX27 Mec DAT","341033E01156	KMSX BLACK",
"348104J00446	EGu-Mec","*PARA ATRIBUIR*",
       //MAQUINAS LEONARDO
"341930Y04213	FMX20 G1600 9800","341930Y04272	FMX20 G1600 9800	Black","341930Y04273	FMX20 G1600 9800 Black",
"341930Y04274	FMX20 G1600 9800 Black","341930Y04472	FMX20 G1200 11600","341930Y04473	FMX20 G1200 11600",	
"341930Y04475	FMX20 G1200 11600","341930Y04476	FMX20 G1200 11600","341930Y04478 FMX20 G1200 11600",	
"341930Y04479	FMX20 G1200 11600	DAT","340139Y01970	ERX27 Mec","340139Y01971	ERX27 Mec",	
"340139Y02084	ERX27 Mec","340139Y01992	ERX27 Mec","340139Y02012	ERX27 Mec 1200mmRISCO",
"340139Y02014	ERX27 Mec","340139Y02021	ERX27 Mec","340139Y02025	ERX27 Mec",	
"340139Y02026	ERX27 Mec","340139Y02047	ERX27 Mec","340139Y02059	ERX27 Mec",	
"340139Y02077	ERX27 Mec	BlacK","340139Y02082	ERX27 Mec","340261Y06091	EGV-16 5466	RISCO",
"340261Y06092	EGV-16 5466	RISCO","340261Y06093	EGV-16 5466	RISCO",
       // MAQUINAS LUCAS"
"341930Y03552	FMX20 G1200 11600	CD3 DAT3","341930Y04247	FMX20 G1600 9800","341930Y04259	FMX20 G1200 11600	CD3 DAT3",
"341930Y04276	FMX20 G1600 9800 Black","341930Y04277	FMX20 G1600 9800 Black","341930Y04293	FMX20 G1200 11600	CD3 DAT3",
"341930Y04447	FMX20 G1800 9800","340138Y00970	ERX27 Dire√ß√£o El√©tr","340139Y02011	ERX27 Mec 1200mmSUP",
"340139Y02034	ERX27 Mec	Black","340139Y02035	ERX27 Black","340139Y02044	ERX27 Mec",	
"340139Y02045	ERX27 Mec","340139Y02062	ERX27 Mec","340139Y02080	ERX27 Mec","340139Y02125	ERX27 Mec 1800mm	CD3 DAT3",
"340139Y02132	ERX27 Mec 1800mm CD3 DAT3","340139Y02135	ERX27 Mec 1800mm CD3 DAT3",
"340139Y02159	ERX27 Mec","340139Y02166 Mec 1800mm	CD3 DAT3","340139Y02173	ERX27 Mec 1800mm CD3 DAT3",
"340261Y06099	EGV-16 	CD3 DAT3","340261Y06100	EGV-16 	CD3 DAT3","340261Y06096	EGV-16 5466	SUP",
"340261Y06094	EGV-16 5466	SUP","PARA ATRIBUIR",
       
       // MAQUINAS LUIZ
"341930Y04217	FMX20 G1600 9800","341930Y04243	FMX20 G1600 9800","341930Y04244	FMX20 G1600 9800",	
"341930Y04245	FMX20 G1600 9800","341930Y04270	FMx20 G1600 9800	Black","341930Y04396	FMX20 G1200 11600",	
"341930Y04402	FMX20 G1200 11600","341930Y04433	FMX20 Clamp  9800","341930Y04485	FMX20 G1800 1160",	
"340139Y02075	ERX27 Mec","340139Y02096	ERX27 Mec","340139Y02104	ERX27 Mec","340139Y02112	ERX27 Mec",	
"340139Y02114	ERX27 Mec","340139Y02119	ERX27 Mec","340139Y02127	ERX27 Mec","340139Y02137	ERX27 Mec 1800mm	Black",
"340139Y02157	ERX27 Mec	Black","341033E01098	KMSX-27	Black","340139Y02138	ERX27 Mec","340139Y02140	ERX27 Mec",	
"340139Y02149	ERX27 Mec","340139Y02152	ERX27 Mec","340139Y02213	ERX27 Mec","340261Y06095	EGV-16 5466","PARA ATRIBUIR",
       
       //MAQUINAS NEILTON 
"341930Y04215	FMX20 G1600 9800","341930Y04216	FMX20 G1600 9800","341930Y04256	FMX20 Clamp  9800",	
"340139Y04260	FMX20 G1600 9800	Black","341930Y04262	FMX20 G1600 9800	Black", 
"341930Y04264	FMX20 G1600 9800	Black","341930Y04384	FMX20 G1200 11600","341930Y04385	FMX20 G1200 11600",	
"341930Y04391	FMX20 G1200 11600","341930Y04395	FMX20 G1200 11600","341930Y04439	FMX20 Clamp  9800",
"340139Y01993	ERX27 Mec","340139Y01981	ERX27 Mec","340139Y01966	ERX27 Mec",	
"340139Y02008	ERX27 Mec","340139Y02030	ERX27 Mec Black","340139Y02007	ERX27 Mec",	
"340139Y02087	ERX27 Mec","340139Y02090	ERX27 Mec","340139Y02091	ERX27 Mec",	
"340139Y02092	ERX27 Mec","340139Y02094	ERX27 Mec","340139Y02105	ERX27 Mec",	"340139Y02151	ERX27 Mec",	
"340139Y02212	ERX27 Mec","PARA ATRIBUIR",

       // MAQUINAS SAMUEL
"341930Y04257	FMX20 Clamp  9800",
"341930Y04258	FMX20 Clamp  9800",	
"341930Y04287	FMX20 Clamp  9800",	
"341930Y04378 FMX20 G1200 11600",	
"341930Y04381	FMX20 G1200 11600",	
"341930Y04446	FMX20 G1800 9800",	
"341930Y04448	FMX20 G1800 9800",	
"341930Y04450	FMX20 G1800 9800",	
"341930Y04471	FMX20 G1200 11600",	
"340139Y02029	ERX27 Mec",	
"340139Y02079	ERX27 Mec",	
"340139Y02083	ERX27 Mec",	
"340139Y02085	ERX27 Mec",	
"340139Y02093	ERX27 Mec",	
"300139Y02097	ERX27 Mec",	
"340139Y02101	ERX27 Mec",	
"340139Y02102	ERX27 Mec",	
"340139Y02107	ERX27 Mec",	
"340139Y02120	ERX27 Mec",	
"340139Y02123	ERX27 Mec",	
"340139Y02128	ERX27 Mec",	
"340139Y02172	ERX27 Mec	Black",
"340261Y06097	EGV-16 5466",	
"341033E01113	KMSX-27	Black", 
"341033C00768	KMSX-27	Black",
"341033E01154	KMSX-27	Black", 

       //MAQUINAS THIAGO

"341930Y04246	FMX20 G1600 9800	SUP",
"341930Y04251	FMX20 G1600 9800",	
"341930Y04261	FMX20 G1600 9800	Black", 
"341930Y04263	FMX20 G1600 9800	Black", 
"341930Y04265	FMX20 G1600 9800	Black", 
"341930Y04275	FMX20 G1600 9800	DAT", 
"341930Y04278	FMX20 G1600 9800	Black", 
"341930Y04374	FMX20 G1800 11600	DAT", 
"341930Y04376	FMX20 G1800 11600",	
"341930Y04438	FMX20 G1800 9800",	
"341930Y04451	FMX20 G1800 9800",	
"341930Y04484	FMX20 G1800 9800	DAT", 
"340139Y02069	ERX27 Mec",	
"340139Y02074	ERX27 Mec",	
"340139Y02076	ERX27 Mec",	
"340139Y02098	ERX27 Mec",	
"340139Y02108	ERX27 Mec",	
"340139Y02136	ERX27 Mec	SUP", 
"340139Y02167	ERX27 Mec 1800mm DAT",
"340139Y02171	ERX27 Mec",	
"340139Y02183	ERX27 Mec",	
"340139Y02202	ERX27 Mec 2400mm DAT", 
"340139Y02203	ERX27 Mec 2400mm DAT", 
"340139Y02204	ERX27 Mec 2400mm DAT", 
"732916	Rebocador Jacto RB30",	
 
       
    ];

    // Nomes personalizados para at√© 10 p√°ginas
const nomesPaginas = [
  "Henrique",   // P√°gina 1
  "Junior",     // P√°gina 2
  "Leonardo",   // P√°gina 3
  "Lucas",      // P√°gina 4
  "Luiz",       // P√°gina 5
  "Neilton",      // P√°gina 6
  "Samuel",     // P√°gina 7
  "Thiago",     // P√°gina 8
  "Andr√©",      // P√°gina 9
  "Pedro"       // P√°gina 10
  ];
    const SENHA = "1234";

    function paginarMaquinas(listaCompleta, tamanhoPagina) {
      const paginas = {};
      for (let i = 0; i < listaCompleta.length; i += tamanhoPagina) {
        const numeroPagina = (i / tamanhoPagina);
        const nomePagina = nomesPaginas[numeroPagina] || `P√°gina ${numeroPagina+1}`;
        paginas[nomePagina] = listaCompleta.slice(i, i + tamanhoPagina);
      }
      return paginas;
    }

    const TAMANHO_DA_PAGINA = 26;
    const maquinasPorPagina = paginarMaquinas(todasAsMaquinas, TAMANHO_DA_PAGINA);
    const navButtonsEl = document.getElementById("nav-buttons");
    const tabela = document.getElementById("tabela-maquinas");
    const percentualEl = document.getElementById("percentual");
    const tituloSecaoEl = document.getElementById("titulo-secao");

    let manutencoes = JSON.parse(localStorage.getItem("manutencoes")) || {};

    /* fun√ß√£o que ajusta a largura do input OS conforme conte√∫do */
    function ajustarWidthOS(input) {
      try {
        const len = input.value ? input.value.length : 0;
        const px = Math.max(160, Math.min(420, 8 + len * 8)); // calcula largura (limites)
        input.style.width = px + 'px';
      } catch (e) { /* silencioso */ }
    }

    function renderizarTabela(nomePagina, listaFiltrada = null) {
      tabela.innerHTML = "";
      tituloSecaoEl.textContent = listaFiltrada ? "Resultado da pesquisa" : nomePagina;

      const maquinas = listaFiltrada || maquinasPorPagina[nomePagina];
      if (!maquinas) return;

      maquinas.forEach(codigo => {
        const row = document.createElement("tr");

        const colCodigo = document.createElement("td");
        colCodigo.textContent = codigo;

        const colHori = document.createElement("td");
        const inputHori = document.createElement("input");
        inputHori.type = "number";
        inputHori.classList.add("horimetro");
        inputHori.value = manutencoes[codigo]?.horimetro || "";
        colHori.appendChild(inputHori);

        const colOS = document.createElement("td");
        const inputOS = document.createElement("input");
        inputOS.type = "text";
        inputOS.classList.add("osNum");
        inputOS.value = manutencoes[codigo]?.os || "";
        inputOS.title = inputOS.value || ""; // tooltip com valor completo
        ajustarWidthOS(inputOS); // ajusta largura inicial
        // atualiza t√≠tulo e largura enquanto digita
        inputOS.addEventListener('input', () => {
          inputOS.title = inputOS.value;
          ajustarWidthOS(inputOS);
        });
        colOS.appendChild(inputOS);

        const colAcao = document.createElement("td");
        const botao = document.createElement("button");
        botao.classList.add("acao");

        const colData = document.createElement("td");
        const inputData = document.createElement("input");
        inputData.type = "date";
        inputData.classList.add("dataManut");
        inputData.value = manutencoes[codigo]?.data || "";
        colData.appendChild(inputData);

        const colOleo1 = document.createElement("td");
        const inputOleo1 = document.createElement("input");
        inputOleo1.type = "number";
        inputOleo1.classList.add("oleo");
        inputOleo1.value = manutencoes[codigo]?.oleo1 || "";
        colOleo1.appendChild(inputOleo1);

        const colOleo2 = document.createElement("td");
        const inputOleo2 = document.createElement("input");
        inputOleo2.type = "number";
        inputOleo2.classList.add("oleo");
        inputOleo2.value = manutencoes[codigo]?.oleo2 || "";
        colOleo2.appendChild(inputOleo2);

        const colDataAnterior = document.createElement("td");
        colDataAnterior.textContent = manutencoes[codigo]?.dataAnterior || "-";

        const colDias = document.createElement("td");
        if (manutencoes[codigo]?.dataAnterior) {
          const dataAnt = new Date(manutencoes[codigo].dataAnterior);
          const hoje = new Date();
          const diff = Math.floor((hoje - dataAnt) / (1000 * 60 * 60 * 24));
          const faltam = 30 - diff;
          if (faltam > 0) {
            colDias.textContent = `${faltam} dias`;
          } else {
            colDias.textContent = "‚ö† Atrasado";
            colDias.classList.add("atrasado");
          }
        } else {
          colDias.textContent = "-";
        }

        function atualizarBotao() {
          botao.classList.remove("concluido", "a-realizar");
          if (manutencoes[codigo]?.feito) {
            botao.textContent = "Conclu√≠do";
            botao.classList.add("concluido");
          } else {
            botao.textContent = "A Realizar";
            botao.classList.add("a-realizar");
          }
        }

        botao.addEventListener('click', () => {
          if (!manutencoes[codigo]) manutencoes[codigo] = {};
          if (!inputOS.value) {
            alert("‚ö† √â obrigat√≥rio preencher o N¬∫ da O.S antes de concluir!");
            return;
          }
          manutencoes[codigo].feito = !manutencoes[codigo].feito;
          if (manutencoes[codigo].feito) {
            manutencoes[codigo].data = inputData.value || new Date().toISOString().split("T")[0];
            manutencoes[codigo].horimetro = inputHori.value;
            manutencoes[codigo].os = inputOS.value;
            manutencoes[codigo].oleo1 = inputOleo1.value;
            manutencoes[codigo].oleo2 = inputOleo2.value;
            inputData.value = manutencoes[codigo].data;
          }
          salvarStatus();
          atualizarBotao();
        });

        [inputHori, inputOS, inputData, inputOleo1, inputOleo2].forEach(el => {
          el.addEventListener("change", () => {
            if (!manutencoes[codigo]) manutencoes[codigo] = {};
            manutencoes[codigo].horimetro = inputHori.value;
            manutencoes[codigo].os = inputOS.value;
            manutencoes[codigo].data = inputData.value;
            manutencoes[codigo].oleo1 = inputOleo1.value;
            manutencoes[codigo].oleo2 = inputOleo2.value;
            // atualiza t√≠tulo e largura ao salvar/alterar
            inputOS.title = inputOS.value;
            ajustarWidthOS(inputOS);
            salvarStatus();
          });
        });

        atualizarBotao();
        colAcao.appendChild(botao);
        row.appendChild(colCodigo);
        row.appendChild(colHori);
        row.appendChild(colOS);
        row.appendChild(colAcao);
        row.appendChild(colData);
        row.appendChild(colOleo1);
        row.appendChild(colOleo2);
        row.appendChild(colDataAnterior);
        row.appendChild(colDias);
        tabela.appendChild(row);
      });
    }

    function criarNavegacao() {
      Object.keys(maquinasPorPagina).forEach(nomePagina => {
        const button = document.createElement('button');
        button.textContent = nomePagina;
        button.addEventListener('click', () => renderizarTabela(nomePagina));
        navButtonsEl.appendChild(button);
      });
    }

    function salvarStatus() {
      localStorage.setItem("manutencoes", JSON.stringify(manutencoes));
      atualizarPercentual();
    }

    function novaCompetencia() {
      const senha = prompt("Digite a senha para iniciar um NOVO M√äS:");
      if (senha !== SENHA) {
        alert("‚ùå Senha incorreta. Opera√ß√£o cancelada!");
        return;
      }
      if (confirm("Tem certeza que deseja iniciar um NOVO M√äS?")) {
        Object.keys(manutencoes).forEach(codigo => {
          const reg = manutencoes[codigo];
          if (reg.feito) {
            manutencoes[codigo].dataAnterior = reg.data || "";
          }
          manutencoes[codigo].horimetro = "";
          manutencoes[codigo].os = "";
          manutencoes[codigo].feito = false;
        });
        salvarStatus();
        location.reload();
      }
    }

    function atualizarPercentual() {
      const totalMaquinas = todasAsMaquinas.length;
      const feitos = Object.values(manutencoes).filter(m => m.feito).length;
      const perc = totalMaquinas > 0 ? ((feitos / totalMaquinas) * 100).toFixed(1) : 0;
      percentualEl.textContent = `Preventivas conclu√≠das: ${perc}%`;
    }

    function exportarExcel() {
      const dados = [["C√≥digo da M√°quina", "Hor√≠metro", "N¬∫ O.S.", "Status", "Data", "Troca √ìleo 01", "Troca √ìleo 02", "Data Anterior", "Dias Faltantes"]];
      todasAsMaquinas.forEach(codigo => {
        const registro = manutencoes[codigo] || {};
        let diasFaltando = "";
        if (registro.dataAnterior) {
          const dataAnt = new Date(registro.dataAnterior);
          const hoje = new Date();
          const diff = Math.floor((hoje - dataAnt) / (1000 * 60 * 60 * 24));
          diasFaltando = diff < 30 ? `${30 - diff} dias` : "‚ö† Atrasado";
        }
        dados.push([
          codigo,
          registro.horimetro || "",
          registro.os || "",
          registro.feito ? "Conclu√≠do" : "A Realizar",
          registro.data || "",
          registro.oleo1 || "",
          registro.oleo2 || "",
          registro.dataAnterior || "",
          diasFaltando
        ]);
      });
      const ws = XLSX.utils.aoa_to_sheet(dados);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, "Manuten√ß√£o");
      XLSX.writeFile(wb, "controle_manutencao.xlsx");
    }

    function filtrarTabela() {
      const termo = document.getElementById("pesquisa").value.toLowerCase();
      if (!termo) {
        const primeiraPagina = Object.keys(maquinasPorPagina)[0];
        if (primeiraPagina) renderizarTabela(primeiraPagina);
        return;
      }
      const listaFiltrada = todasAsMaquinas.filter(codigo => codigo.toLowerCase().includes(termo));
      renderizarTabela(null, listaFiltrada);
    }

    // limpar atrasados (mantive as fun√ß√µes que voc√™ j√° tinha)
    function limparDataAnteriorAtrasados() {
      const senha = prompt("Digite a senha para LIMPAR as Datas Anteriores ATRASADAS:");
      if (senha !== SENHA) { alert("‚ùå Senha incorreta. Opera√ß√£o cancelada!"); return; }
      if (!confirm("Tem certeza que deseja apagar apenas as Datas Anteriores ATRASADAS?")) return;
      Object.keys(manutencoes).forEach(codigo => {
        const reg = manutencoes[codigo];
        if (reg && reg.dataAnterior) {
          const dataAnt = new Date(reg.dataAnterior);
          const hoje = new Date();
          const diff = Math.floor((hoje - dataAnt) / (1000 * 60 * 60 * 24));
          if (diff >= 30) manutencoes[codigo].dataAnterior = "";
        }
      });
      salvarStatus();
      location.reload();
    }

    function limparDiasFaltantesAtrasados() {
      const senha = prompt("Digite a senha para LIMPAR os Dias Faltantes ATRASADOS:");
      if (senha !== SENHA) { alert("‚ùå Senha incorreta. Opera√ß√£o cancelada!"); return; }
      if (!confirm("Tem certeza que deseja apagar apenas os Dias Faltantes ATRASADOS?")) return;
      Object.keys(manutencoes).forEach(codigo => {
        const reg = manutencoes[codigo];
        if (reg && reg.dataAnterior) {
          const dataAnt = new Date(reg.dataAnterior);
          const hoje = new Date();
          const diff = Math.floor((hoje - dataAnt) / (1000 * 60 * 60 * 24));
          if (diff >= 30) manutencoes[codigo].dataAnterior = "";
        }
      });
      salvarStatus();
      location.reload();
    }

    criarNavegacao();
    const primeiraPagina = Object.keys(maquinasPorPagina)[0];
    if (primeiraPagina) renderizarTabela(primeiraPagina);
    atualizarPercentual();
  </script>
</body>
</html>












